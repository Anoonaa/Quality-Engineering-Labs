<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MerchantHub</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- ===== NAVBAR ===== -->
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="nav-brand"><span class="brand-text">MerchantHub</span></div>
        <ul class="nav-links">
      <li><a href="index.html" class="nav-link active" data-page="home">Home</a></li>
      <li><a href="market.html" class="nav-link" data-page="market">Products</a></li>
      <li><a href="payment.html" class="nav-link" data-page="payment">Sell</a></li>
      <li><a href="transactions.html" class="nav-link" data-page="transactions">Transactions</a></li>
      <li><a href="customers.html" class="nav-link" data-page="customers">Customers</a></li>
      <li><a href="analytics.html" class="nav-link" data-page="analytics">Analytics</a></li>
      <li><a href="wallet.html" class="nav-link" data-page="wallet">Wallet</a></li>
      <li><a href="receipts.html" class="nav-link" data-page="receipts">Receipts</a></li>
      <li><a href="settings.html" class="nav-link" data-page="settings">Settings</a></li>
      <li><a href="login.html" class="nav-link" data-page="login">Account</a></li>
    </ul>
    <div class="nav-user" id="nav-user">
      <span id="nav-username" data-testid="nav-username"></span>
      <button id="nav-logout" data-testid="logout-btn" class="btn btn-sm btn-outline" style="display:none;">Logout</button>
    </div>
  </nav>

  <!-- ===== HERO ===== -->
  <main>
    <section class="hero" data-testid="hero-section">
      <div class="hero-bg-pattern"></div>
      <div class="hero-content">
        <div class="hero-badge">Quality Engineering Lab</div>
        <h1 data-testid="hero-title">Digital Merchant Ecosystem</h1>
        <p class="hero-subtitle" data-testid="hero-subtitle">
          A fintech merchant platform built to help you practice and explore Playwright testing — sell airtime, vouchers, process payments, and manage transactions.
        </p>
        <div class="hero-links">
          <a href="payment.html" class="hero-link">Sell Products</a>
          <a href="transactions.html" class="hero-link">Transactions</a>
          <a href="market.html" class="hero-link">Product Catalog</a>
          <a href="login.html" class="hero-link">Merchant Login</a>
        </div>
      </div>
      <div class="hero-illustration" aria-hidden="true">
        <svg viewBox="0 0 400 320" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="40" y="30" width="320" height="220" rx="12" fill="#f5f5f3" stroke="#e8e6e1" stroke-width="1.5"/>
          <rect x="40" y="30" width="320" height="36" rx="12" fill="#1a1a1a"/>
          <rect x="40" y="54" width="320" height="12" fill="#1a1a1a"/>
          <circle cx="60" cy="48" r="5" fill="#c53030"/>
          <circle cx="78" cy="48" r="5" fill="#c9a96e"/>
          <circle cx="96" cy="48" r="5" fill="#2d8a4e"/>
          <rect x="160" y="42" width="120" height="12" rx="6" fill="#333"/>
          <rect x="64" y="86" width="120" height="10" rx="3" fill="#e8e6e1"/>
          <rect x="64" y="106" width="200" height="8" rx="3" fill="#f0ede8"/>
          <rect x="64" y="122" width="160" height="8" rx="3" fill="#f0ede8"/>
          <rect x="64" y="150" width="272" height="36" rx="6" fill="#fff" stroke="#e8e6e1" stroke-width="1"/>
          <rect x="72" y="158" width="80" height="20" rx="4" fill="#f5f5f3"/>
          <rect x="64" y="200" width="100" height="32" rx="6" fill="#1a1a1a"/>
          <rect x="76" y="212" width="76" height="8" rx="3" fill="#fff"/>
          <rect x="176" y="200" width="80" height="32" rx="6" fill="#fff" stroke="#e8e6e1" stroke-width="1"/>
          <rect x="188" y="212" width="56" height="8" rx="3" fill="#e8e6e1"/>
          <line x1="64" y1="146" x2="336" y2="146" stroke="#e8e6e1" stroke-width="1"/>
          <rect x="300" y="86" width="36" height="36" rx="8" fill="#f0ede8"/>
          <path d="M312 98 L318 104 L324 98" stroke="#c9a96e" stroke-width="2" fill="none" stroke-linecap="round"/>
          <path d="M312 106 L318 112 L324 106" stroke="#c9a96e" stroke-width="2" fill="none" stroke-linecap="round"/>
          <path d="M290 240 L298 268 L304 258 L316 264 L312 254 L302 254 L290 240Z" fill="#1a1a1a" stroke="#fff" stroke-width="1.5"/>
        </svg>
      </div>
    </section>

    <!-- ===== ABOUT SECTION ===== -->
    <section class="about-section" data-testid="about-section">
      <div class="container">
        <div class="about-grid">
          <div class="about-text">
            <h2 class="about-heading">Making Life Easier</h2>
            <p class="about-description">
              MerchantHub is a modern merchant payment platform simulating real fintech workflows — digital product distribution, customer management, and point-of-sale operations.
              This playground simulates merchant workflows — sell airtime &amp; data, process 1Voucher transactions, handle cash-outs,
              and manage account payments, all while practicing end-to-end testing with Playwright.
            </p>
            <div class="about-stats">
              <div class="about-stat">
                <span class="about-stat-value" data-testid="stat-products" id="stat-products">--</span>
                <span class="about-stat-label">Products</span>
              </div>
              <div class="about-stat">
                <span class="about-stat-value" data-testid="stat-transactions" id="stat-transactions">--</span>
                <span class="about-stat-label">Transactions</span>
              </div>
              <div class="about-stat">
                <span class="about-stat-value" data-testid="stat-categories" id="stat-categories">--</span>
                <span class="about-stat-label">Categories</span>
              </div>
            </div>
          </div>
          <div class="about-visual" aria-hidden="true">
            <div class="about-code-block">
              <div class="code-header">
                <span class="code-dot code-dot--red"></span>
                <span class="code-dot code-dot--yellow"></span>
                <span class="code-dot code-dot--green"></span>
                <span class="code-filename">flash-sell.spec.ts</span>
              </div>
              <pre class="code-body"><code><span class="code-kw">import</span> { test, expect } <span class="code-kw">from</span> <span class="code-str">'@playwright/test'</span>;

<span class="code-fn">test</span>(<span class="code-str">'sell airtime updates wallet'</span>, <span class="code-kw">async</span> ({ page }) => {
  <span class="code-kw">await</span> page.goto(<span class="code-str">'/payment.html'</span>);
  <span class="code-kw">await</span> page.getByTestId(<span class="code-str">'select-product'</span>).selectOption(<span class="code-str">'airtime'</span>);
  <span class="code-kw">await</span> page.getByTestId(<span class="code-str">'submit-btn'</span>).click();
  <span class="code-kw">await</span> expect(page.getByTestId(<span class="code-str">'sale-receipt'</span>))
    .toBeVisible();
});</code></pre>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== INTERACTIVE DEMOS ===== -->
    <div class="container">
      <div class="divider"></div>

      <!-- ===== WALLET BALANCE SECTION ===== -->
      <section class="counter-section" data-testid="balance-section">
        <h2 class="section-title">Merchant Wallet</h2>
        <p class="section-desc">Your merchant wallet balance. Changes here persist across all pages — top up, withdraw, or reset.</p>
        <div class="counter-card">
          <div class="counter-box">
            <button class="btn btn-icon" data-testid="withdraw-btn" id="withdraw-btn" aria-label="Withdraw R100">
              <i data-lucide="minus"></i>
            </button>
            <span class="counter-value" data-testid="balance-value" id="balance-value">R0</span>
            <button class="btn btn-icon" data-testid="deposit-btn" id="deposit-btn" aria-label="Deposit R100">
              <i data-lucide="plus"></i>
            </button>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:center;">
            <button class="btn btn-outline btn-sm" data-testid="deposit-500" id="deposit-500">+R500</button>
            <button class="btn btn-outline btn-sm" data-testid="deposit-1000" id="deposit-1000">+R1,000</button>
            <button class="btn btn-outline" data-testid="reset-btn" id="reset-btn">Reset Balance</button>
          </div>
        </div>
      </section>

      <div class="divider"></div>

      <!-- ===== EXCHANGE RATE SECTION ===== -->
      <section class="joke-section" data-testid="rate-section">
        <h2 class="section-title">Live ZAR Exchange Rate</h2>
        <p class="section-desc">Fetches a live USD to ZAR exchange rate — great for testing async content and loading states.</p>
        <div class="joke-box">
          <p class="joke-text" data-testid="rate-text" id="rate-text">Click the button to fetch the latest rate!</p>
          <div class="joke-loading" data-testid="rate-loading" id="rate-loading" style="display:none;">
            <i data-lucide="loader" class="spin"></i> Loading...
          </div>
        </div>
        <button class="btn btn-primary" data-testid="fetch-rate-btn" id="fetch-rate-btn">
          <i data-lucide="refresh-cw"></i> Get Rate
        </button>
      </section>

      <div class="divider"></div>

      <!-- ===== QUICK LINKS ===== -->
      <section class="quick-links-section" data-testid="quick-links">
        <h2 class="section-title">Explore the Ecosystem</h2>
        <div class="quick-links-grid">
          <a href="market.html" class="quick-link-card" data-testid="link-products">
            <i data-lucide="package"></i>
            <h3>Product Catalog</h3>
            <p>Browse &amp; buy airtime, data, vouchers, gaming credits</p>
          </a>
          <a href="payment.html" class="quick-link-card" data-testid="link-sell">
            <i data-lucide="shopping-bag"></i>
            <h3>Sell Product</h3>
            <p>Process over-the-counter sales with receipt generation</p>
          </a>
          <a href="transactions.html" class="quick-link-card" data-testid="link-transactions">
            <i data-lucide="receipt"></i>
            <h3>Transactions</h3>
            <p>View, filter, and manage your full transaction ledger</p>
          </a>
          <a href="wallet.html" class="quick-link-card" data-testid="link-wallet">
            <i data-lucide="wallet"></i>
            <h3>Wallet</h3>
            <p>Top up, transfer funds, and track your wallet activity</p>
          </a>
          <a href="customers.html" class="quick-link-card" data-testid="link-customers">
            <i data-lucide="users"></i>
            <h3>Customers</h3>
            <p>Manage your customer directory and loyalty tiers</p>
          </a>
          <a href="analytics.html" class="quick-link-card" data-testid="link-analytics">
            <i data-lucide="bar-chart-3"></i>
            <h3>Analytics</h3>
            <p>Charts, KPIs, and insights from your sales data</p>
          </a>
          <a href="receipts.html" class="quick-link-card" data-testid="link-receipts">
            <i data-lucide="file-text"></i>
            <h3>Receipts</h3>
            <p>Browse and print all purchase and sale receipts</p>
          </a>
          <a href="settings.html" class="quick-link-card" data-testid="link-settings">
            <i data-lucide="settings"></i>
            <h3>Settings</h3>
            <p>Store profile, notifications, security &amp; data management</p>
          </a>
        </div>
      </section>
    </div>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="footer" role="contentinfo">
    <div class="footer-inner">
      <p>&copy; 2026 MerchantHub &mdash; Merchant Payment Platform</p>
      <ul class="footer-links">
        <li><a href="transactions.html">Transactions</a></li>
        <li><a href="market.html">Products</a></li>
        <li><a href="payment.html">Sell</a></li>
        <li><a href="login.html">Login</a></li>
      </ul>
    </div>
  </footer>

  <script src="db.js"></script>
  <script src="app.js"></script>
  <script>
    // ===== Wallet (persistent via db.js) =====
    const balanceEl = document.getElementById('balance-value');

    function refreshBalance() {
      const bal = FlashDB.getWallet().balance;
      const prefix = bal < 0 ? '-R' : 'R';
      balanceEl.textContent = prefix + Math.abs(bal).toLocaleString('en-ZA', {minimumFractionDigits: 0});
    }

    document.getElementById('deposit-btn').addEventListener('click', () => {
      FlashDB.adjustWallet(100);
      refreshBalance();
    });
    document.getElementById('withdraw-btn').addEventListener('click', () => {
      FlashDB.adjustWallet(-100);
      refreshBalance();
    });
    document.getElementById('deposit-500').addEventListener('click', () => {
      FlashDB.adjustWallet(500);
      refreshBalance();
    });
    document.getElementById('deposit-1000').addEventListener('click', () => {
      FlashDB.adjustWallet(1000);
      refreshBalance();
    });
    document.getElementById('reset-btn').addEventListener('click', () => {
      FlashDB.setWalletBalance(5000);
      refreshBalance();
    });

    refreshBalance();

    // ===== About stats from DB =====
    const products = FlashDB.getProducts();
    const txns = FlashDB.getTransactions();
    const cats = [...new Set(products.map(p => p.category))];
    document.getElementById('stat-products').textContent = products.length;
    document.getElementById('stat-transactions').textContent = txns.length;
    document.getElementById('stat-categories').textContent = cats.length;

    // ===== Exchange rate fetcher =====
    document.getElementById('fetch-rate-btn').addEventListener('click', async () => {
      const rateText = document.getElementById('rate-text');
      const loading = document.getElementById('rate-loading');
      rateText.style.display = 'none';
      loading.style.display = 'flex';
      try {
        const res = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        const data = await res.json();
        const zarRate = data.rates.ZAR;
        rateText.textContent = '1 USD = ' + zarRate.toFixed(4) + ' ZAR';
      } catch (e) {
        rateText.textContent = 'Failed to load rate. Try again!';
      }
      loading.style.display = 'none';
      rateText.style.display = 'block';
    });
  </script>
</body>
</html>
