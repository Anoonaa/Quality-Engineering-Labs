<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MerchantHub</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- ===== NAVBAR ===== -->
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="nav-brand"><span class="brand-text">MerchantHub</span></div>
        <ul class="nav-links">
      <li><a href="index.html" class="nav-link active" data-page="home">Home</a></li>
      <li><a href="market.html" class="nav-link" data-page="market">Products</a></li>
      <li><a href="payment.html" class="nav-link" data-page="payment">Sell</a></li>
      <li><a href="transactions.html" class="nav-link" data-page="transactions">Transactions</a></li>
      <li><a href="customers.html" class="nav-link" data-page="customers">Customers</a></li>
      <li><a href="analytics.html" class="nav-link" data-page="analytics">Analytics</a></li>
      <li><a href="wallet.html" class="nav-link" data-page="wallet">Wallet</a></li>
      <li><a href="receipts.html" class="nav-link" data-page="receipts">Receipts</a></li>
      <li><a href="settings.html" class="nav-link" data-page="settings">Settings</a></li>
      <li><a href="login.html" class="nav-link" data-page="login">Account</a></li>
    </ul>
    <div class="nav-user" id="nav-user">
      <button class="btn btn-icon btn-sm" id="dark-mode-toggle" data-testid="dark-mode-toggle" aria-label="Toggle dark mode" onclick="toggleDarkMode()">
        <i data-lucide="moon"></i>
      </button>
      <span id="nav-username" data-testid="nav-username"></span>
      <button id="nav-logout" data-testid="logout-btn" class="btn btn-sm btn-outline" style="display:none;">Logout</button>
    </div>
  </nav>

  <!-- ===== HERO ===== -->
  <main>
    <section class="hero" data-testid="hero-section">
      <div class="hero-bg-pattern"></div>
      <div class="hero-content">
        <div class="hero-badge">Quality Engineering Lab</div>
        <h1 data-testid="hero-title">Digital Merchant Ecosystem</h1>
        <p class="hero-subtitle" data-testid="hero-subtitle">
          A fintech merchant platform built to help you practice and explore Playwright testing — sell airtime, vouchers, process payments, and manage transactions.
        </p>
        <div class="hero-links">
          <a href="payment.html" class="hero-link">Sell Products</a>
          <a href="transactions.html" class="hero-link">Transactions</a>
          <a href="market.html" class="hero-link">Product Catalog</a>
          <a href="login.html" class="hero-link">Merchant Login</a>
        </div>
      </div>
      <div class="hero-illustration" aria-hidden="true">
        <div class="hero-card-visual">
          <div class="hero-credit-card">
            <div class="hero-card-chip"></div>
            <div class="hero-card-number">•••• •••• •••• 4289</div>
            <div class="hero-card-details">
              <div class="hero-card-name">MERCHANT HUB</div>
              <div class="hero-card-expiry">12/28</div>
            </div>
            <div class="hero-card-logo">
              <i data-lucide="credit-card" style="width:32px;height:32px;"></i>
            </div>
          </div>
          <div class="hero-floating-stat hero-floating-stat-1">
            <i data-lucide="trending-up" style="width:16px;height:16px;color:var(--success);"></i>
            <span>+12.4%</span>
          </div>
          <div class="hero-floating-stat hero-floating-stat-2">
            <i data-lucide="shield-check" style="width:16px;height:16px;color:var(--accent);"></i>
            <span>Secure</span>
          </div>
        </div>
      </div>
    </section>

    <section class="partners-section" data-testid="partners-section">
      <div class="container">
        <p class="partners-label">Trusted by leading providers</p>
        <div class="partners-logos">
          <div class="partner-logo"><img src="https://logo.clearbit.com/vodacom.co.za" alt="Vodacom" loading="lazy" onerror="this.parentElement.style.display='none'" /><span>Vodacom</span></div>
          <div class="partner-logo"><img src="https://logo.clearbit.com/mtn.co.za" alt="MTN" loading="lazy" onerror="this.parentElement.style.display='none'" /><span>MTN</span></div>
          <div class="partner-logo"><img src="https://logo.clearbit.com/telkom.co.za" alt="Telkom" loading="lazy" onerror="this.parentElement.style.display='none'" /><span>Telkom</span></div>
          <div class="partner-logo"><img src="https://logo.clearbit.com/playstation.com" alt="PlayStation" loading="lazy" onerror="this.parentElement.style.display='none'" /><span>PlayStation</span></div>
          <div class="partner-logo"><img src="https://logo.clearbit.com/steampowered.com" alt="Steam" loading="lazy" onerror="this.parentElement.style.display='none'" /><span>Steam</span></div>
          <div class="partner-logo"><img src="https://logo.clearbit.com/showmax.com" alt="Showmax" loading="lazy" onerror="this.parentElement.style.display='none'" /><span>Showmax</span></div>
        </div>
      </div>
    </section>

    <!-- ===== ABOUT SECTION ===== -->
    <section class="about-section" data-testid="about-section">
      <div class="container">
        <div class="about-grid">
          <div class="about-text">
            <h2 class="about-heading">Powering Merchant Success</h2>
            <p class="about-description">
              MerchantHub is a modern merchant payment platform simulating real fintech workflows — digital product distribution, customer management, and point-of-sale operations.
              This playground simulates merchant workflows — sell airtime &amp; data, process 1Voucher transactions, handle cash-outs,
              and manage account payments, all while practicing end-to-end testing with Playwright.
            </p>
            <div class="about-stats">
              <div class="about-stat">
                <span class="about-stat-value" data-testid="stat-products" id="stat-products">--</span>
                <span class="about-stat-label">Products</span>
              </div>
              <div class="about-stat">
                <span class="about-stat-value" data-testid="stat-transactions" id="stat-transactions">--</span>
                <span class="about-stat-label">Transactions</span>
              </div>
              <div class="about-stat">
                <span class="about-stat-value" data-testid="stat-categories" id="stat-categories">--</span>
                <span class="about-stat-label">Categories</span>
              </div>
            </div>
          </div>
          <div class="about-visual" aria-hidden="true">
            <div class="about-code-block">
              <div class="code-header">
                <span class="code-dot code-dot--red"></span>
                <span class="code-dot code-dot--yellow"></span>
                <span class="code-dot code-dot--green"></span>
                <span class="code-filename">flash-sell.spec.ts</span>
              </div>
              <pre class="code-body"><code><span class="code-kw">import</span> { test, expect } <span class="code-kw">from</span> <span class="code-str">'@playwright/test'</span>;

<span class="code-fn">test</span>(<span class="code-str">'sell airtime updates wallet'</span>, <span class="code-kw">async</span> ({ page }) => {
  <span class="code-kw">await</span> page.goto(<span class="code-str">'/payment.html'</span>);
  <span class="code-kw">await</span> page.getByTestId(<span class="code-str">'select-product'</span>).selectOption(<span class="code-str">'airtime'</span>);
  <span class="code-kw">await</span> page.getByTestId(<span class="code-str">'submit-btn'</span>).click();
  <span class="code-kw">await</span> expect(page.getByTestId(<span class="code-str">'sale-receipt'</span>))
    .toBeVisible();
});</code></pre>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== INTERACTIVE DEMOS ===== -->
    <div class="container">
      <div class="divider"></div>

      <!-- ===== WALLET BALANCE SECTION ===== -->
      <section class="counter-section" data-testid="balance-section">
        <h2 class="section-title">Merchant Wallet</h2>
        <p class="section-desc">Your merchant wallet balance. Changes here persist across all pages — top up, withdraw, or reset.</p>
        <div class="counter-card">
          <div class="counter-box">
            <button class="btn btn-icon" data-testid="withdraw-btn" id="withdraw-btn" aria-label="Withdraw R100">
              <i data-lucide="minus"></i>
            </button>
            <span class="counter-value" data-testid="balance-value" id="balance-value">R0</span>
            <button class="btn btn-icon" data-testid="deposit-btn" id="deposit-btn" aria-label="Deposit R100">
              <i data-lucide="plus"></i>
            </button>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:center;">
            <button class="btn btn-outline btn-sm" data-testid="deposit-500" id="deposit-500">+R500</button>
            <button class="btn btn-outline btn-sm" data-testid="deposit-1000" id="deposit-1000">+R1,000</button>
            <button class="btn btn-outline" data-testid="reset-btn" id="reset-btn">Reset Balance</button>
          </div>
        </div>
      </section>

      <div class="divider"></div>

      <!-- ===== EXCHANGE RATE SECTION ===== -->
      <section class="joke-section" data-testid="rate-section">
        <h2 class="section-title">Live ZAR Exchange Rate</h2>
        <p class="section-desc">Fetches a live USD to ZAR exchange rate — great for testing async content and loading states.</p>
        <div class="joke-box">
          <p class="joke-text" data-testid="rate-text" id="rate-text">Click the button to fetch the latest rate!</p>
          <div class="joke-loading" data-testid="rate-loading" id="rate-loading" style="display:none;">
            <i data-lucide="loader" class="spin"></i> Loading...
          </div>
        </div>
        <button class="btn btn-primary" data-testid="fetch-rate-btn" id="fetch-rate-btn">
          <i data-lucide="refresh-cw"></i> Get Rate
        </button>
      </section>

      <div class="divider"></div>

      <section class="features-highlight" data-testid="features-highlight">
        <h2 class="section-title">Why Merchants Choose Us</h2>
        <div class="features-grid">
          <div class="feature-card glass-card">
            <div class="feature-icon" style="background: linear-gradient(135deg, #2563eb, #7c3aed);">
              <i data-lucide="zap"></i>
            </div>
            <h3>Instant Processing</h3>
            <p>Process airtime, data bundles, and voucher sales in under 2 seconds with real-time wallet updates.</p>
          </div>
          <div class="feature-card glass-card">
            <div class="feature-icon" style="background: linear-gradient(135deg, #059669, #2d8a4e);">
              <i data-lucide="shield-check"></i>
            </div>
            <h3>Secure Transactions</h3>
            <p>Every transaction is logged, traceable, and protected with merchant PIN verification.</p>
          </div>
          <div class="feature-card glass-card">
            <div class="feature-icon" style="background: linear-gradient(135deg, #c9a96e, #d97706);">
              <i data-lucide="bar-chart-3"></i>
            </div>
            <h3>Real-time Analytics</h3>
            <p>Track revenue, top products, customer behavior, and performance trends with live dashboards.</p>
          </div>
          <div class="feature-card glass-card">
            <div class="feature-icon" style="background: linear-gradient(135deg, #dc2626, #c53030);">
              <i data-lucide="users"></i>
            </div>
            <h3>Customer Management</h3>
            <p>Build loyalty tiers, track spending history, and manage your customer directory effortlessly.</p>
          </div>
        </div>
      </section>

      <div class="divider"></div>

      <!-- ===== QUICK LINKS ===== -->
      <section class="quick-links-section" data-testid="quick-links">
        <h2 class="section-title">Explore the Ecosystem</h2>
        <div class="quick-links-grid">
          <a href="market.html" class="quick-link-card" data-testid="link-products">
            <i data-lucide="package"></i>
            <h3>Product Catalog</h3>
            <p>Browse &amp; buy airtime, data, vouchers, gaming credits</p>
          </a>
          <a href="payment.html" class="quick-link-card" data-testid="link-sell">
            <i data-lucide="shopping-bag"></i>
            <h3>Sell Product</h3>
            <p>Process over-the-counter sales with receipt generation</p>
          </a>
          <a href="transactions.html" class="quick-link-card" data-testid="link-transactions">
            <i data-lucide="receipt"></i>
            <h3>Transactions</h3>
            <p>View, filter, and manage your full transaction ledger</p>
          </a>
          <a href="wallet.html" class="quick-link-card" data-testid="link-wallet">
            <i data-lucide="wallet"></i>
            <h3>Wallet</h3>
            <p>Top up, transfer funds, and track your wallet activity</p>
          </a>
          <a href="customers.html" class="quick-link-card" data-testid="link-customers">
            <i data-lucide="users"></i>
            <h3>Customers</h3>
            <p>Manage your customer directory and loyalty tiers</p>
          </a>
          <a href="analytics.html" class="quick-link-card" data-testid="link-analytics">
            <i data-lucide="bar-chart-3"></i>
            <h3>Analytics</h3>
            <p>Charts, KPIs, and insights from your sales data</p>
          </a>
          <a href="receipts.html" class="quick-link-card" data-testid="link-receipts">
            <i data-lucide="file-text"></i>
            <h3>Receipts</h3>
            <p>Browse and print all purchase and sale receipts</p>
          </a>
          <a href="settings.html" class="quick-link-card" data-testid="link-settings">
            <i data-lucide="settings"></i>
            <h3>Settings</h3>
            <p>Store profile, notifications, security &amp; data management</p>
          </a>
        </div>
      </section>
    </div>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="footer" role="contentinfo">
    <div class="footer-inner">
      <div class="footer-brand">
        <span class="brand-text">MerchantHub</span>
        <p class="footer-tagline">Digital merchant payment platform for modern businesses</p>
      </div>
      <div class="footer-links-grid">
        <div class="footer-col">
          <h4>Platform</h4>
          <ul>
            <li><a href="market.html">Products</a></li>
            <li><a href="payment.html">Sell</a></li>
            <li><a href="wallet.html">Wallet</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Business</h4>
          <ul>
            <li><a href="transactions.html">Transactions</a></li>
            <li><a href="analytics.html">Analytics</a></li>
            <li><a href="receipts.html">Receipts</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Account</h4>
          <ul>
            <li><a href="customers.html">Customers</a></li>
            <li><a href="settings.html">Settings</a></li>
            <li><a href="login.html">Login</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 MerchantHub &mdash; Merchant Payment Platform</p>
    </div>
  </footer>

  <script src="db.js"></script>
  <script src="app.js"></script>
  <script>
    // ===== Wallet (persistent via db.js) =====
    const balanceEl = document.getElementById('balance-value');

    function refreshBalance() {
      const bal = FlashDB.getWallet().balance;
      const prefix = bal < 0 ? '-R' : 'R';
      balanceEl.textContent = prefix + Math.abs(bal).toLocaleString('en-ZA', {minimumFractionDigits: 0});
    }

    document.getElementById('deposit-btn').addEventListener('click', () => {
      FlashDB.adjustWallet(100);
      refreshBalance();
    });
    document.getElementById('withdraw-btn').addEventListener('click', () => {
      FlashDB.adjustWallet(-100);
      refreshBalance();
    });
    document.getElementById('deposit-500').addEventListener('click', () => {
      FlashDB.adjustWallet(500);
      refreshBalance();
    });
    document.getElementById('deposit-1000').addEventListener('click', () => {
      FlashDB.adjustWallet(1000);
      refreshBalance();
    });
    document.getElementById('reset-btn').addEventListener('click', () => {
      FlashDB.setWalletBalance(5000);
      refreshBalance();
    });

    refreshBalance();

    // ===== About stats from DB =====
    const products = FlashDB.getProducts();
    const txns = FlashDB.getTransactions();
    const cats = [...new Set(products.map(p => p.category))];
    document.getElementById('stat-products').textContent = products.length;
    document.getElementById('stat-transactions').textContent = txns.length;
    document.getElementById('stat-categories').textContent = cats.length;

    // ===== Exchange rate fetcher =====
    document.getElementById('fetch-rate-btn').addEventListener('click', async () => {
      const rateText = document.getElementById('rate-text');
      const loading = document.getElementById('rate-loading');
      rateText.style.display = 'none';
      loading.style.display = 'flex';
      try {
        const res = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        const data = await res.json();
        const zarRate = data.rates.ZAR;
        rateText.textContent = '1 USD = ' + zarRate.toFixed(4) + ' ZAR';
      } catch (e) {
        rateText.textContent = 'Failed to load rate. Try again!';
      }
      loading.style.display = 'none';
      rateText.style.display = 'block';
    });
  </script>
</body>
</html>
