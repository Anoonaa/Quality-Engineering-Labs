<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todos - Playwright Lab</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="nav-brand">
      <span class="brand-text">Playwright Lab</span>
    </div>
    <ul class="nav-links">
      <li><a href="index.html" class="nav-link" data-page="home">Home</a></li>
      <li><a href="todos.html" class="nav-link active" data-page="todos">Todos</a></li>
      <li><a href="dogs.html" class="nav-link" data-page="dogs">Dogs</a></li>
      <li><a href="form.html" class="nav-link" data-page="form">Form</a></li>
      <li><a href="login.html" class="nav-link" data-page="login">Login</a></li>
    </ul>
    <div class="nav-user" id="nav-user">
      <span id="nav-username" data-testid="nav-username"></span>
      <button id="nav-logout" data-testid="logout-btn" class="btn btn-sm btn-outline" style="display:none;">Logout</button>
    </div>
  </nav>

  <div class="page-banner">
    <section class="page-header">
      <h1 data-testid="page-title"><i data-lucide="check-square"></i> Todo List</h1>
      <p class="page-desc">Powered by <a href="https://jsonplaceholder.typicode.com" target="_blank">JSONPlaceholder API</a>. Great for testing API calls, list rendering, and CRUD operations.</p>
    </section>
  </div>

  <main class="container">

    <!-- Add Todo -->
    <div class="todo-input-row">
      <input type="text" id="todo-input" data-testid="todo-input" placeholder="Add a new todo..." class="input" aria-label="New todo text" />
      <button class="btn btn-primary" data-testid="add-todo-btn" id="add-todo-btn">
        <i data-lucide="plus"></i> Add
      </button>
    </div>

    <!-- Filter -->
    <div class="todo-filters" data-testid="todo-filters">
      <button class="btn btn-filter active" data-filter="all" data-testid="filter-all">All</button>
      <button class="btn btn-filter" data-filter="active" data-testid="filter-active">Active</button>
      <button class="btn btn-filter" data-filter="completed" data-testid="filter-completed">Completed</button>
    </div>

    <!-- Stats -->
    <div class="todo-stats" data-testid="todo-stats">
      <span data-testid="todo-count" id="todo-count">0 items</span>
      <span data-testid="completed-count" id="completed-count">0 completed</span>
    </div>

    <!-- Loading -->
    <div class="loading-state" data-testid="todo-loading" id="todo-loading">
      <i data-lucide="loader" class="spin"></i> Loading todos...
    </div>

    <!-- Todo List -->
    <ul class="todo-list" data-testid="todo-list" id="todo-list" role="list"></ul>

    <!-- Empty state -->
    <div class="empty-state" data-testid="empty-state" id="empty-state" style="display:none;">
      <i data-lucide="inbox"></i>
      <p>No todos to display.</p>
    </div>
  </main>

  <footer class="footer" role="contentinfo">
    <p>&copy; 2026 Playwright Lab. Built for testing purposes.</p>
  </footer>

  <script src="app.js"></script>
  <script>
    let todos = [];
    let currentFilter = 'all';

    const todoList = document.getElementById('todo-list');
    const todoInput = document.getElementById('todo-input');
    const todoCount = document.getElementById('todo-count');
    const completedCount = document.getElementById('completed-count');
    const loading = document.getElementById('todo-loading');
    const emptyState = document.getElementById('empty-state');

    async function fetchTodos() {
      loading.style.display = 'flex';
      todoList.style.display = 'none';
      try {
        const res = await fetch('https://jsonplaceholder.typicode.com/todos?_limit=10');
        todos = await res.json();
      } catch (e) {
        todos = [];
      }
      loading.style.display = 'none';
      todoList.style.display = 'block';
      renderTodos();
    }

    function renderTodos() {
      const filtered = todos.filter(t => {
        if (currentFilter === 'active') return !t.completed;
        if (currentFilter === 'completed') return t.completed;
        return true;
      });

      todoList.innerHTML = '';
      filtered.forEach(todo => {
        const li = document.createElement('li');
        li.className = 'todo-item' + (todo.completed ? ' completed' : '');
        li.setAttribute('data-testid', `todo-item-${todo.id}`);
        li.setAttribute('role', 'listitem');
        li.innerHTML = `
          <label class="todo-label">
            <input type="checkbox" ${todo.completed ? 'checked' : ''} 
              data-testid="todo-checkbox-${todo.id}" 
              aria-label="Toggle ${todo.title}"
              class="todo-checkbox" />
            <span class="todo-text" data-testid="todo-text-${todo.id}">${todo.title}</span>
          </label>
          <button class="btn btn-icon btn-danger-icon" data-testid="delete-todo-${todo.id}" aria-label="Delete todo">
            <i data-lucide="trash-2"></i>
          </button>
        `;
        // Checkbox toggle
        li.querySelector('input[type="checkbox"]').addEventListener('change', () => {
          todo.completed = !todo.completed;
          renderTodos();
        });
        // Delete
        li.querySelector('button').addEventListener('click', () => {
          todos = todos.filter(t => t.id !== todo.id);
          renderTodos();
        });
        todoList.appendChild(li);
      });

      lucide.createIcons();

      const total = todos.length;
      const done = todos.filter(t => t.completed).length;
      todoCount.textContent = `${total} item${total !== 1 ? 's' : ''}`;
      completedCount.textContent = `${done} completed`;

      emptyState.style.display = filtered.length === 0 ? 'flex' : 'none';
      todoList.style.display = filtered.length === 0 ? 'none' : 'block';
    }

    // Add todo
    document.getElementById('add-todo-btn').addEventListener('click', () => {
      const text = todoInput.value.trim();
      if (!text) return;
      const newTodo = { id: Date.now(), title: text, completed: false };
      todos.unshift(newTodo);
      todoInput.value = '';
      renderTodos();
    });

    todoInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') document.getElementById('add-todo-btn').click();
    });

    // Filters
    document.querySelectorAll('.btn-filter').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        renderTodos();
      });
    });

    fetchTodos();
  </script>
</body>
</html>
