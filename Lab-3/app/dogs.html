<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dog Gallery - Playwright Lab</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="nav-brand">
      <span class="brand-text">Playwright Lab</span>
    </div>
    <ul class="nav-links">
      <li><a href="index.html" class="nav-link" data-page="home">Home</a></li>
      <li><a href="todos.html" class="nav-link" data-page="todos">Todos</a></li>
      <li><a href="dogs.html" class="nav-link active" data-page="dogs">Dogs</a></li>
      <li><a href="form.html" class="nav-link" data-page="form">Form</a></li>
      <li><a href="login.html" class="nav-link" data-page="login">Login</a></li>
    </ul>
    <div class="nav-user" id="nav-user">
      <span id="nav-username" data-testid="nav-username"></span>
      <button id="nav-logout" data-testid="logout-btn" class="btn btn-sm btn-outline" style="display:none;">Logout</button>
    </div>
  </nav>

  <div class="page-banner">
    <section class="page-header">
      <h1 data-testid="page-title"><i data-lucide="dog"></i> Dog Gallery</h1>
      <p class="page-desc">Powered by <a href="https://dog.ceo/dog-api/" target="_blank">Dog CEO API</a>. Great for testing dynamic images, loading states, and async content.</p>
    </section>
  </div>

  <main class="container">

    <!-- Controls -->
    <div class="dog-controls">
      <div class="select-wrapper">
        <label for="breed-select">Breed:</label>
        <select id="breed-select" data-testid="breed-select" class="input select" aria-label="Select breed">
          <option value="random">Random</option>
        </select>
      </div>
      <div class="count-wrapper">
        <label for="image-count">Count:</label>
        <input type="number" id="image-count" data-testid="image-count" class="input" value="6" min="1" max="12" aria-label="Number of images" />
      </div>
      <button class="btn btn-primary" data-testid="fetch-dogs-btn" id="fetch-dogs-btn">
        <i data-lucide="refresh-cw"></i> Fetch Dogs
      </button>
    </div>

    <!-- Loading -->
    <div class="loading-state" data-testid="dogs-loading" id="dogs-loading" style="display:none;">
      <i data-lucide="loader" class="spin"></i> Fetching adorable dogs...
    </div>

    <!-- Gallery -->
    <div class="dog-gallery" data-testid="dog-gallery" id="dog-gallery"></div>

    <!-- Error -->
    <div class="error-state" data-testid="dogs-error" id="dogs-error" style="display:none;">
      <i data-lucide="alert-triangle"></i>
      <p>Failed to load images. Please try again.</p>
    </div>
  </main>

  <footer class="footer" role="contentinfo">
    <p>&copy; 2026 Playwright Lab. Built for testing purposes.</p>
  </footer>

  <script src="app.js"></script>
  <script>
    const breedSelect = document.getElementById('breed-select');
    const countInput = document.getElementById('image-count');
    const gallery = document.getElementById('dog-gallery');
    const loading = document.getElementById('dogs-loading');
    const errorState = document.getElementById('dogs-error');

    // Load breeds
    async function loadBreeds() {
      try {
        const res = await fetch('https://dog.ceo/api/breeds/list/all');
        const data = await res.json();
        Object.keys(data.message).forEach(breed => {
          const opt = document.createElement('option');
          opt.value = breed;
          opt.textContent = breed.charAt(0).toUpperCase() + breed.slice(1);
          breedSelect.appendChild(opt);
        });
      } catch (e) { /* fail silently */ }
    }

    async function fetchDogs() {
      const breed = breedSelect.value;
      const count = Math.min(Math.max(parseInt(countInput.value) || 6, 1), 12);
      
      gallery.innerHTML = '';
      errorState.style.display = 'none';
      loading.style.display = 'flex';

      try {
        let url;
        if (breed === 'random') {
          url = `https://dog.ceo/api/breeds/image/random/${count}`;
        } else {
          url = `https://dog.ceo/api/breed/${breed}/images/random/${count}`;
        }
        const res = await fetch(url);
        const data = await res.json();
        
        if (data.status === 'success') {
          data.message.forEach((imgUrl, i) => {
            const card = document.createElement('div');
            card.className = 'dog-card';
            card.setAttribute('data-testid', `dog-card-${i}`);
            card.innerHTML = `
              <img src="${imgUrl}" alt="Dog photo ${i + 1}" data-testid="dog-image-${i}" loading="lazy" />
              <div class="dog-card-overlay">
                <button class="btn btn-icon btn-fav" data-testid="fav-btn-${i}" aria-label="Favorite">
                  <i data-lucide="heart"></i>
                </button>
              </div>
            `;
            // Favorite toggle
            card.querySelector('.btn-fav').addEventListener('click', (e) => {
              e.currentTarget.classList.toggle('active');
            });
            gallery.appendChild(card);
          });
          lucide.createIcons();
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        errorState.style.display = 'flex';
      }
      loading.style.display = 'none';
    }

    document.getElementById('fetch-dogs-btn').addEventListener('click', fetchDogs);
    loadBreeds();
    fetchDogs();
  </script>
</body>
</html>
